# 교재 예습

### 거래, 블록, 채굴 및 블록체인

비트코인 시스템은 전통적인 은행 및 결제 시스템과 달리 분산된 신뢰를 기반으로 합니다. 중앙 집중식 신뢰 권한 대신, 비트코인에서는 신뢰가 비트코인 시스템 내의 다양한 참가자 간의 상호작용에서 나타나는 emergent property로 형성됩니다. 이 장에서는 비트코인의 단일 거래를 추적하여 고차원적으로 비트코인을 살펴보고, 그것이 ‘신뢰받는’ 상태가 되고 비트코인 분산 합의 메커니즘에 의해 수용되며, 마지막으로 모든 거래의 분산 원장인 블록체인에 기록되는 과정을 살펴보겠습니다. 이후 장에서는 거래, 네트워크 및 채굴 뒤에 있는 기술에 대해 심도 있게 다룰 것입니다.

### 비트코인 개요

그림 2-1에 표시된 개요 다이어그램에서 비트코인 시스템은 키가 포함된 지갑을 가진 사용자, 네트워크를 통해 전파되는 거래, 경쟁적인 계산을 통해 합의된 블록체인을 생산하는 채굴자로 구성되어 있음을 확인할 수 있습니다. 이 장의 각 예시는 비트코인 네트워크에서 실제로 이루어진 거래를 기반으로 하며, 사용자(조, 앨리스, 밥, 고페시)가 하나의 지갑에서 다른 지갑으로 자금을 보내는 과정을 시뮬레이션하여 상호작용을 설명합니다. 비트코인 네트워크를 통해 블록체인까지 거래를 추적하는 동안 블록체인 탐색기 사이트를 사용하여 각 단계를 시각화할 것입니다. 블록체인 탐색기는 비트코인 검색 엔진으로 작동하는 웹 애플리케이션으로, 주소, 거래 및 블록을 검색하고 그들 간의 관계와 흐름을 볼 수 있게 해줍니다.

그림 2-1. 비트코인 개요

인기 있는 블록체인 탐색기는 다음과 같습니다: • 비트코인 블록 탐색기 • 블록사이퍼 탐색기 • [blockchain.info](http://blockchain.info/) • BitPay 인사이트

이들 각각은 비트코인 주소, 거래 해시, 블록 번호 또는 블록 해시를 입력하여 비트코인 네트워크에서 해당 정보를 검색할 수 있는 검색 기능을 제공합니다. 각 거래 또는 블록 예시와 함께, 사용자가 직접 찾아보고 자세히 연구할 수 있도록 URL을 제공할 것입니다. 커피 한 잔 사기 이전 장에서 소개된 앨리스는 첫 비트코인을 방금 획득한 새로운 사용자입니다. 10페이지의 “첫 번째 비트코인 얻기”에서 앨리스는 친구 조와 만나 현금을 비트코인으로 교환했습니다. 조가 생성한 거래는 앨리스의 지갑에 0.10 BTC를 채워주었습니다. 이제 앨리스는 캘리포니아 팔로알토에 있는 밥의 커피숍에서 커피 한 잔을 사는 최초의 소매 거래를 하게 됩니다. 밥의 카페는 최근 결제 시스템에 비트코인 옵션을 추가하여 비트코인 결제를 받기 시작했습니다. 밥의 카페 가격은 지역 통화(미국 달러)로 표시되어 있지만, 계산대에서는 고객이 달러 또는 비트코인으로 결제할 수 있는 옵션이 있습니다.

앨리스는 커피 한 잔을 주문하고, 밥은 모든 거래와 마찬가지로 이를 등록기에 입력합니다. 판매 시점 시스템은 자동으로 총 가격을 현재 시장 환율로 미국 달러에서 비트코인으로 변환하여 두 통화 모두에서 가격을 표시합니다: 총: $1.50 USD 0.015 BTC. 밥은 "그건 1.50달러 또는 15밀리비트입니다."라고 말합니다. 밥의 판매 시점 시스템은 또한 결제 요청을 포함하는 특별한 QR 코드를 자동으로 생성합니다(그림 2-2를 참조). 단순히 목적지 비트코인 주소를 포함하는 QR 코드와 달리, 결제 요청은 목적지 주소, 결제 금액 및 "밥의 카페"와 같은 일반적인 설명을 포함하는 QR 인코딩된 URL입니다. 이를 통해 비트코인 지갑 애플리케이션은 결제를 보내는 데 사용되는 정보를 미리 입력할 수 있으며, 사용자에게는 읽기 쉬운 설명을 표시합니다. 비트코인 지갑 애플리케이션으로 QR 코드를 스캔하면 앨리스가 볼 수 있는 내용을 확인할 수 있습니다.

지갑으로 이걸 스캔하여 주소와 금액을 확인해 보세요. 그러나 돈을 보내지 마세요.

앨리스는 스마트폰을 사용하여 화면에 표시된 바코드를 스캔합니다. 그녀의 스마트폰은 밥의 카페에 0.0150 BTC의 결제 금액을 보여주고, 그녀는 결제를 승인하기 위해 전송을 선택합니다. 몇 초 내에 (신용카드 승인과 비슷한 시간 동일), 밥은 등록기에서 거래를 확인하고, 거래가 완료됩니다. 다음 섹션에서는 이 거래를 좀 더 자세히 살펴보겠습니다. 우리는 앨리스의 지갑이 이것을 어떻게 구성했는지, 네트워크를 통해 어떻게 전파되었는지, 어떻게 검증되었는지, 그리고 마지막으로 밥이 이후 거래에서 그 금액을 어떻게 사용할 수 있는지를 보게 될 것입니다. 비트코인 네트워크는 밀리비트코인(비트코인의 1/1000)부터 비트코인의 1/100,000,000까지의 분수 값으로 거래할 수 있습니다. 이는 사토시로 알려져 있습니다. 이 책에서는 가장 작은 단위(1 사토시)에서 모든 비트코인이 채굴될 총 수량(21,000,000)까지 모든 비트코인 화폐의 양을 지칭하기 위해 '비트코인'이라는 용어를 사용할 것입니다.

### 비트코인 거래

간단히 말하면, 거래는 네트워크에 특정 비트코인 가치를 소유하고 있는 사람이 그 가치를 다른 소유자에게 이전하도록 승인했다는 것을 알리는 것입니다. 새로운 소유자는 다른 소유자에게 이전을 승인하는 또 다른 거래를 생성함으로써 비트코인을 사용할 수 있으며, 이러한 방식으로 소유권의 연쇄가 이어집니다. 거래 입력과 출력 거래는 복식부기 장부의 항목처럼 보입니다. 각 거래는 비트코인 계정에 대한 차변과 같은 하나 이상의 '입력'을 포함합니다. 거래의 반대편에는 비트코인 계정에 추가되는 신용과 같은 하나 이상의 '출력'이 있습니다. 입력과 출력(차변 및 신용)의 합계가 반드시 동일하지는 않습니다. 대신 출력의 총합은 입력보다 약간 적으며, 그 차이는 담장자(마이너)가 거래를 장부에 포함시키기 위해 징수하는 소액의 거래 수수료를 나타냅니다. 비트코인 거래는 도표 2-3의 장부 항목으로 표시됩니다.

이 거래는 또한 지출되는 비트코인의 각 금액(입력)에 대한 소유권 증명을 포함하고 있으며, 이는 소유자의 디지털 서명의 형태로 제공되며, 이는 누구나 독립적으로 검증할 수 있습니다. 비트코인 용어로 '지출'은 이전 거래에서 새로운 소유자에게 비트코인 주소로 식별된 가치를 이전하는 거래에 서명하는 것입니다.

### 거래 체인

애리슨의 지불이 밥의 카페에 사용된 것은 이전 거래의 출력을 입력으로 사용하는 것입니다. 이전 장에서 애리슨은 현금과 맞바꿔 친구 조에게서 비트코인을 받았습니다. 그 거래는 애리슨의 키에 의해 잠긴 비트코인 가치를 생성했습니다. 애리슨의 새로운 거래는 밥의 카페에 대해 이전 거래를 입력으로 참조하고 커피 한 잔을 위한 새 출력을 생성하며 잔돈을 받습니다. 거래는 체인을 형성하여 최신 거래의 입력이 이전 거래의 출력에 해당합니다. 애리슨의 키는 이전 거래 출력을 해제하는 서명을 제공하여 비트코인 네트워크에 그녀가 자금을 소유하고 있음을 증명합니다. 그녀는 커피에 대한 지불을 밥의 주소에 첨부하여 해당 출출을 '포획'하여 밥이 그 금액을 사용하기 위해 서명을 생성해야 한다는 요구 조건을 추가합니다. 이는 애리슨과 밥 간의 가치 이전을 나타냅니다. 조에서 애리슨, 애리슨에서 밥으로 이어지는 이 거래 체인은 도표 2-4에 나와 있습니다.

### 변경 사항 만들기

많은 비트코인 거래에는 새로운 소유자의 주소와 현재 소유자의 주소를 참조하는 출력이 포함됩니다. 이를 변경 주소라고 합니다. 이는 거래 입력이 통화 지폐처럼 분할될 수 없기 때문입니다. 가게에서 5달러의 상품을 구매하지만 20달러 지폐로 지불할 경우, 15달러의 잔돈을 받을 것으로 예상합니다. 같은 개념이 비트코인 거래 입력에도 적용됩니다. 5비트코인짜리 상품을 구매했지만 20비트코인 입력만 사용할 수 있다면, 5비트코인을 가게 소유자에게 보내고 15비트코인을 잔돈으로 본인에게 다시 보냅니다(적용 가능한 거래 수수료를 제외하고). 중요한 점은 변경 주소가 입력 주소와 동일할 필요는 없으며, 개인 정보 보호 이유로 종종 소유자의 지갑에서 새로운 주소가 사용됩니다. 다른 지갑은 사용자 요청에 따라 지불을 하기 위해 입력을 집계할 때 서로 다른 전략을 사용할 수 있습니다. 여러 작은 입력을 집계하거나 원하는 지불액과 같거나 큰 입력을 사용할 수 있습니다. 지갑이 원하는 지불액과 거래 수수료를 정확히 일치시키도록 입력을 집계할 수 없는 경우, 지갑은 일부 잔돈을 생성해야 합니다. 이는 사람들이 현금을 다루는 방식과 매우 유사합니다. 만약 항상 주머니에 있는 가장 큰 지폐를 사용한다면, 잔돈으로 가득 찬 주머니가 될 것입니다. 잔돈만 사용하면 항상 큰 지폐만 있게 됩니다. 사람들은 본능적으로 이 두 극단 사이에서 균형을 찾고, 비트코인 지갑 개발자들은 이 균형을 프로그래밍하려고 노력하고 있습니다.

요약하자면, 거래는 거래 입력에서 거래 출력으로 가치를 이동합니다. 입력은 이전 거래의 출력에 대한 참조로, 가치가 어디에서 오는지를 보여줍니다. 거래 출력은 특정 가치를 새로운 소유자의 비트코인 주소로 지정하며 원래 소유자에게 반환되는 잔돈을 포함할 수 있습니다. 한 거래의 출력은 새로운 거래의 입력으로 사용될 수 있어, 소유자가 가치를 이동시키면서 소유권의 연쇄를 생성합니다(그림 2-4 참조). 일반적인 거래 형태 가장 일반적인 거래 형태는 한 주소에서 다른 주소로의 단순 지불로, 종종 원래 소유자에게 반환되는 일부 '잔돈'이 포함됩니다. 이 유형의 거래는 하나의 입력과 두 개의 출력을 가지며 그림 2-5에 표시됩니다.

또 다른 일반적인 거래 형태는 여러 개의 입력을 하나의 출력으로 집계하는 것입니다(그림 2-6 참조). 이는 동전과 지폐 더미를 하나의 큰 지폐로 교환하는 현실 세계의 동등한 형태를 나타냅니다. 이러한 거래는 때때로 지불의 잔돈으로 받은 소액을 정리하기 위해 지갑 애플리케이션에서 생성되기도 합니다.

마지막으로, 비트코인 원장에서 자주 볼 수 있는 또 다른 거래 형태는 하나의 입력을 여러 출력으로 분배하는 거래입니다. 이는 여러 수신자를 나타냅니다(그림 2-7 참조). 이러한 유형의 거래는 상업적 기관이 여러 직원에게 급여를 처리할 때와 같이 자금을 분배하는 데 사용되기도 합니다.

### 거래 구성

알리스의 지갑 애플리케이션은 알리스의 사양에 맞는 거래를 구성하기 위한 적절한 입력 및 출력을 선택하는 모든 로직을 포함하고 있습니다. 알리스는 목적지와 금액만 지정하면 나머지는 지갑 애플리케이션에서 세부사항을 보지 않고 진행됩니다. 중요한 점은, 지갑 애플리케이션은 완전히 오프라인 상태에서도 거래를 구성할 수 있다는 것입니다. 집에서 수표를 작성한 후 나중에 봉투에 넣어 은행에 보내는 것처럼, 거래는 비트코인 네트워크에 연결된 상태에서 구성되고 서명될 필요가 없습니다.

### 올바른 입력 얻기

알리스의 지갑 애플리케이션은 먼저 보브에게 보내고자 하는 금액을 지불할 수 있는 입력을 찾아야 합니다. 대부분의 지갑은 지갑에 있는 주소에 속한 모든 사용 가능한 출력을 추적합니다. 따라서 알리스의 지갑에는 현금으로 교환된 조의 거래에서 생성된 거래 출력의 사본이 포함되어 있을 것입니다(10페이지의 '비트코인 첫 구매하기' 참조). 전체 노드 클라이언트로 실행되는 비트코인 지갑 애플리케이션은 블록체인에서 모든 사용되지 않은 출력의 사본을 실제로 포함하고 있습니다. 이는 지갑이 거래 입력을 구성할 수 있게 해주고 수신 거래가 올바른 입력을 가지고 있는지 빠르게 검증할 수 있게 해 줍니다. 그러나 전체 노드 클라이언트는 많은 디스크 공간을 차지하므로 대부분의 사용자 지갑은 사용자의 사용되지 않은 출력만 추적하는 '경량' 클라이언트를 실행합니다.

지갑 애플리케이션이 사용되지 않은 거래 출력을 복사하여 유지하지 않는 경우, 다양한 제공자가 제공하는 API를 사용하여 비트코인 네트워크에 쿼리하여 이 정보를 검색할 수 있습니다. 또는 애플리케이션 프로그래밍 인터페이스(API) 호출을 사용하여 전체 노드에 요청할 수 있습니다. 예제 2-2는 특정 URL에 대해 HTTP GET 명령으로 구성된 API 요청을 보여줍니다. 이 URL은 주소에 대한 모든 사용되지 않은 거래 출력을 반환하며, 어떤 애플리케이션이든 지출을 위한 거래 입력을 구성하는 데 필요한 정보를 제공합니다. 우리는 간단한 명령줄 HTTP 클라이언트인 cURL을 사용하여 응답을 검색합니다.

예제 2-2의 응답은 Alice의 주소 1Cdid9KFAaatwczBwBttQcw XYCpvK8h7FK의 소유권 아래에 사용되지 않은 출력(아직 상환되지 않은 출력)을 보여줍니다. 응답에는 이 사용되지 않은 출력이 포함된 트랜잭션(Joe의 지불)과 사토시 단위의 가치(0.10 비트코인에 해당)가 포함됩니다. 이 정보를 사용하여 Alice의 지갑 애플리케이션은 해당 값을 새 소유자 주소로 전송하는 트랜잭션을 구성할 수 있습니다. Joe에서 Alice로의 트랜잭션을 봅니다. 보시다시피 앨리스의 지갑에는 커피 한 잔을 지불할 수 있는 충분한 비트코인이 단일 미사용 출력에 포함되어 있습니다. 그렇지 않았다면 앨리스의 지갑 애플리케이션은 커피 값을 지불할 만큼 충분한 것을 찾을 때까지 지갑에서 동전을 고르는 것처럼 사용하지 않은 작은 산출물 더미를 "뒤져야 할 수도 있습니다". 두 경우 모두 지갑 애플리케이션이 트랜잭션 출력(결제)을 생성할 때 다음 섹션에서 볼 수 있는 일부 변경 사항을 다시 가져와야 할 수도 있습니다.

### 출력 생성

거래 출력은 값에 대한 부담을 생성하는 스크립트 형태로 생성되며, 스크립트에 대한 해결책의 도입으로만 상환될 수 있습니다. 간단히 말해, 앨리스의 거래 출력은 "이 출력은 밥의 공개 주소에 해당하는 키에서 서명을 제시할 수 있는 사람에게 지급됩니다"라는 내용을 포함하는 스크립트를 포함할 것입니다. 오직 밥만이 해당 주소에 해당하는 키가 있는 지갑을 가지고 있으므로, 오직 밥의 지갑만이 이 출력을 상환하기 위해 그러한 서명을 제시할 수 있습니다. 따라서 앨리스는 밥에게서의 서명을 요구함으로써 출력 값을 "부담"할 것입니다. 이 거래는 또한 두 번째 출력을 포함할 것입니다. 왜냐하면 앨리스의 자금이 0.10 BTC 출력의 형태로 존재하여, 0.015 BTC의 커피 한 잔 비용으로는 너무 많은 돈이기 때문입니다. 앨리스는 0.085 BTC의 잔돈이 필요합니다. 앨리스의 잔돈 지급은 밥에게의 지급과 동일한 거래에서 앨리스의 지갑에 의해 생성된 출력입니다. 본질적으로, 앨리스의 지갑은 그녀의 자금을 두 개의 지급으로 나눕니다: 하나는 밥에게, 다른 하나는 그녀 자신에게 되돌려줍니다. 그녀는 이후의 거래에서 잔돈 출력을 사용할 수 있습니다. 마지막으로, 거래가 네트워크에 의해 신속하게 처리되기 위해, 앨리스의 지갑 애플리케이션은 소액의 수수료를 추가합니다. 이는 거래에서 명시되어 있지 않으며, 입력과 출력의 차이에 의해 암시됩니다. 만약 앨리스가 잔돈으로 0.085 대신 0.0845만큼의 두 번째 출력을 생성하면, 0.0005 BTC (0.5 밀리비트코인)가 남게 됩니다. 입력의 0.10 BTC는 두 개의 출력으로 완전히 사용되지 않으며, 그 합계가 0.10보다 적기 때문입니다. 결과적으로 생기는 차이는 블록체인에 기록될 블록에 거래를 검증하고 포함시키기 위한 수수료로서 광부에 의해 수집되는 거래 수수료입니다. 결과 거래는 블록체인 탐색기 웹 애플리케이션을 사용하여 확인할 수 있습니다.

앨리스에서 밥의 카페로의 거래를 살펴보세요. 장부에 거래 추가하기 앨리스의 지갑 애플리케이션이 생성한 거래는 258바이트 길이이며, 자금 소유권을 확인하고 새로운 소유자를 지정하는 데 필요한 모든 정보를 포함하고 있습니다. 이제 거래는 비트코인 네트워크로 전송되어 블록체인의 일부가 되어야 합니다. 다음 섹션에서는 거래가 어떻게 새로운 블록의 일부가 되는지와 블록이 "채굴"되는 방법을 살펴볼 것입니다. 마지막으로 블록체인에 추가된 새로운 블록이 더 많은 블록이 추가됨에 따라 네트워크에서 점점 더 신뢰받게 되는 과정을 볼 것입니다. 거래 전송하기 거래는 처리하는 데 필요한 모든 정보를 포함하고 있기 때문에 어떻게 또는 어디서 비트코인 네트워크로 전송되든 중요하지 않습니다. 비트코인 네트워크는 피어 투 피어 네트워크로, 각 비트코인 클라이언트는 여러 다른 비트코인 클라이언트에 연결하여 참여합니다. 비트코인 네트워크의 목적은 거래와 블록을 모든 참가자에게 전파하는 것입니다. 

### 어떻게 전파되는가

 서버, 데스크톱 애플리케이션 또는 지갑과 같은 비트코인 네트워크에 "비트코인 프로토콜"을 통해 참여하는 모든 시스템은 비트코인 노드라고 불립니다. 앨리스의 지갑 애플리케이션은 연결된 모든 비트코인 노드에 새로운 거래를 전송할 수 있으며, 유선, WiFi, 모바일 등 어떤 종류의 연결을 통해서도 가능합니다. 그녀의 비트코인 지갑은 직접적으로 밥의 비트코인 지갑에 연결될 필요가 없으며, 카페에서 제공하는 인터넷 연결을 사용할 필요도 없지만, 이 두 가지 옵션도 가능합니다. 유효한 거래를 수신한 어떤 비트코인 노드도 / 그 거래가 이전에 본 적이 없으면 /즉시 연결된 모든 다른 노드에 이를 전달하게 되며, /이를 “플러딩”이라고 하는 전파 기술입니다. 따라서 거래는 피어 투 피어 네트워크 전역으로 빠르게 전파되어 몇 초 안에 많은 비율의 노드에 도달하게 됩니다. 밥의 관점 밥의 비트코인 지갑 애플리케이션이 앨리스의 지갑 애플리케이션에 직접 연결되어 있다면, 밥의 지갑 애플리케이션이 거래를 처음으로 받을 수 있습니다. 그러나 앨리스의 지갑이 다른 노드를 통해 거래를 전송하더라도, 몇 초 내에 밥의 지갑에 도달할 것입니다. 밥의 지갑은 해당 거래가 밥의 키로 환전 가능한 출력을 포함하고 있기 때문에 즉시 앨리스의 거래를 수신 결제라고 식별하게 됩니다. 밥의 지갑 애플리케이션은 거래가 잘 형성되었는지, 이전에 사용되지 않은 입력을 사용했는지, 그리고 다음 블록에 포함되기 위한 충분한 거래 수수료를 포함하고 있는지를 독립적으로 확인할 수 있습니다. 이 시점에서 밥은 거래가 곧 블록에 포함되고 확인될 것이라고 위험이 거의 없이 가정할 수 있습니다.

 비트코인 거래에 대한 일반적인 오해 중 하나는 거래가 새로운 블록을 기다리며 10분 동안 '확인'되어야 하며, 전체 6회의 확인을 위해 최대 60분이 걸린다는 것입니다. 확인은 거래가 전체 네트워크에 의해 수락되었음을 보장하지만, 커피 한 잔과 같은 소액 품목에는 그러한 지연이 필요하지 않습니다. 상인은 확인 없이 유효한 소액 거래를 수용할 수 있으며, 이는 ID나 서명 없이 이루어진 신용카드 결제와 마찬가지로 위험이 없습니다. 오늘날 상인은 이러한 거래를 일상적으로 수용합니다.

### 비트코인 채굴

 앨리스의 거래는 이제 비트코인 네트워크에서 전파되고 있습니다. 이는 검증되고 블록에 포함될 때까지 블록체인의 일부가 되지 않습니다. 자세한 설명은 10장을 참조하세요. 비트코인 신뢰 시스템은 계산에 기반하고 있습니다. 거래는 블록으로 묶이며, 이를 증명하기 위해 엄청난 양의 계산이 필요하지만, 증명된 것으로 검증하는 데는 작은 양의 계산만 필요합니다.

 채굴 과정은 비트코인에서 두 가지 목적을 수행합니다: • 채굴 노드는 비트코인의 합의 규칙을 참조하여 모든 거래를 검증합니다. 따라서 채굴은 무효이거나 형식이 잘못된 거래를 거부함으로써 비트코인 거래의 안전성을 제공합니다. • 채굴은 각 블록에서 새로운 비트코인을 생성합니다. 거의 중앙은행이 새로운 돈을 인쇄하는 것과 같습니다. 블록당 생성되는 비트코인의 양은 제한되어 있으며, 고정 발행 일정에 따라 시간이 지남에 따라 감소합니다. 채굴은 비용과 보상 사이에서 미세한 균형을 이룹니다. 채굴은 수학 문제를 해결하기 위해 전기를 사용합니다. 성공적인 채굴자는 새로운 비트코인과 거래 수수료의 형태로 보상을 받게 됩니다. 그러나 보상은 채굴자가 모든 거래를 합의 규칙에 따라 올바르게 검증했을 때만 수집됩니다. 이 섬세한 균형은 중앙 권한 없이 비트코인에 대한 안전성을 제공합니다. 채굴을 설명하는 좋은 방법은 누군가가 솔루션을 찾을 때마다 리셋되는 거대한 경쟁 스도쿠 게임과 같으며, 난이도는 자동으로 조정되어 대략 10분 이내에 솔루션을 찾도록 설정되어 있습니다. 수천 개의 행과 열로 구성된 거대한 스도쿠 퍼즐을 상상해 보세요. 완성된 퍼즐을 보여주면 당신은 그것을 꽤 빠르게 검증할 수 있습니다.

하지만 퍼즐에 몇 개의 칸이 채워져 있고 나머지는 비어 있다면, 해결하는 데 많은 노력이 필요합니다! 스도쿠의 난이도는 크기를 변경함으로써 조정될 수 있지만(행과 열의 수를 더 많거나 적게), 매우 큰 경우에도 여전히 비교적 쉽게 검증할 수 있습니다. 비트코인에서 사용되는 "퍼즐"은 암호 그래픽 해시에 기반하며 유사한 특성을 보여줍니다: 해결하기는 비대칭적으로 어려운 반면 검증하기는 쉽고, 난이도는 조정할 수 있습니다. 5페이지의 "비트코인의 사용, 사용자 및 그들의 이야기"에서 우리는 상하이에 있는 기업가 Jing을 소개했습니다. Jing은 보상을 위해 경쟁하는 수천 대의 전문 채굴 컴퓨터를 운영하는 채굴 농장을 운영합니다. 약 10분마다 Jing의 채굴 컴퓨터는 거래 블록의 솔루션을 찾기 위한 전 세계 경쟁에서 수천 개의 유사한 시스템과 경쟁합니다. 이러한 솔루션을 찾는 것, 즉 이른바 작업 증명(Proof-of-Work, PoW)은 비트코인 네트워크 전반에 걸쳐 초당 수조 개의 해싱 연산이 필요합니다. 작업 증명 알고리즘은 블록의 헤더와 무작위 숫자를 SHA256 암호화 알고리즘으로 반복적으로 해싱하여 미리 정해진 패턴에 맞는 솔루션이 나타날 때까지 진행됩니다. 이러한 솔루션을 가장 먼저 찾는 채굴자가 경쟁의 라운드를 이기고 해당 블록을 블록체인에 게시합니다. Jing은 2010년에 매우 빠른 데스크톱 컴퓨터를 사용하여 새로운 블록에 대한 적절한 작업 증명을 찾기 위해 채굴을 시작했습니다. 더 많은 채굴자들이 비트코인 네트워크에 합류함에 따라 문제의 난이도는 급격히 증가했습니다. 곧 Jing과 다른 채굴자들은 고급 전용 그래픽 처리 장치(GPU) 카드와 같은 보다 전문화된 하드웨어로 업그레이드했습니다. 이 글을 쓰는 시점에서 난이도가 너무 높아져 ASIC(특정 응용 프로그램에 특화된 집적 회로)로만 채굴하는 것이 수익성이 있습니다. 이는 사실상 하드웨어에 인쇄된 수백 개의 채굴 알고리즘이 단일 실리콘 칩에서 병렬로 실행되는 것입니다. Jing의 회사는 또한 복권 풀과 유사하게 여러 참가자가 자신의 노력과 보상을 공유할 수 있도록 해주는 채굴 풀에 참여합니다. Jing의 회사는 이제 비트코인을 24시간 채굴하기 위해 수천 개의 ASIC 채굴기를 보유한 창고를 운영합니다. 회사는 채굴을 통해 생성할 수 있는 비트코인을 판매하여 전기 비용을 지불하고 수익에서 일부 소득을 창출합니다.

### 블록에서의 채굴 거래

새 거래는 사용자 지갑과 기타 애플리케이션에서 네트워크로 지속적으로 흘러들어옵니다. 이러한 거래는 비트코인 네트워크 노드에 의해 관찰되면 각 노드가 유지하는 검증되지 않은 거래의 임시 풀에 추가됩니다. 채굴자가 새 블록을 구성할 때, 이 풀에서 검증되지 않은 거래를 새 블록에 추가하고, 채굴 알고리즘(작업 증명)을 사용하여 그 새 블록의 유효성을 증명하려고 시도합니다. 채굴 과정은 10장에서 자세히 설명됩니다.

거래는 새로운 블록에 추가되며, 수수료가 가장 높은 거래가 먼저 우선 순위를 부여받고 몇 가지 다른 기준이 적용됩니다. 각 광부는 네트워크로부터 이전 블록을 받자마자 새로운 거래 블록을 채굴하는 과정을 시작하며, 그는 이전 경쟁 라운드를 잃었다는 것을 알고 있습니다. 그는 즉시 새로운 블록을 생성하고, 그 블록에 거래와 이전 블록의 지문을 채우고, 새로운 블록의 작업 증명을 계산하기 시작합니다. 각 광부는 자신의 블록에 특별한 거래를 포함시키는데, 이는 자신의 비트코인 주소에 블록 보상(현재 12.5 비트코인)에 해당하는 금액과 블록에 포함된 모든 거래의 거래 수수료 합계를 지급하는 거래입니다. 만약 그가 그 블록을 유효하게 만드는 해결책을 찾으면, 그는 이 보상을 '얻고' 그의 성공적인 블록이 전 세계 블록체인에 추가되며 그가 포함한 보상 거래가 사용 가능해집니다. 채굴 풀에 참여하는 징은 보상을 풀 주소에 할당하는 새로운 블록을 생성하도록 그의 소프트웨어를 설정했습니다. 그곳에서 보상의 일부는 징과 다른 광부들에게 그들이 지난 라운드에서 기여한 작업량에 비례하여 분배됩니다. 앨리스의 거래는 네트워크에 의해 수집되어 검증되지 않은 거래 풀에 포함되었습니다. 채굴 소프트웨어에 의해 검증된 후, 그것은 징의 채굴 풀에 의해 생성된 새 블록, 즉 후보 블록에 포함되었습니다. 해당 채굴 풀에 참여하는 모든 광부들은 즉시 후보 블록에 대한 작업 증명을 계산하기 시작했습니다. 앨리스의 지갑에서 거래가 처음 전송된 후 약 5분 후, 징의 ASIC 채굴기 중 하나가 후보 블록에 대한 해결책을 찾고 이를 네트워크에 발표했습니다. 다른 광부들이 이 승리 블록을 검증한 후, 그들은 다음 블록을 생성하기 위해 경주를 시작했습니다. 징의 승리 블록은 블록 #277316의 일부가 되어, 앨리스의 거래를 포함하여 420개의 거래를 포함하고 있습니다. 앨리스의 거래가 포함된 블록은 그 거래의 '확인'으로 하나로 계산됩니다.

앨리스의 거래가 포함된 블록을 볼 수 있습니다. 약 19분 후, 새로운 블록 #277317이 다른 채굴자에 의해 채굴됩니다. 이 새로운 블록은 앨리스의 거래가 포함된 블록 #277316 위에 구축되었기 때문에, 블록체인에 더 많은 계산을 추가하여 이러한 거래에 대한 신뢰를 강화합니다. 거래가 포함된 블록 위에 채굴된 각 블록은 앨리스의 거래에 대한 추가 확인으로 간주됩니다. 블록이 서로 쌓일수록 거래를 되돌리는 것이 기하급수적으로 더 어려워져 네트워크에 의해 점점 더 신뢰받게 됩니다. 그림 2-9의 다이어그램에서 앨리스의 거래를 포함하는 블록 #277316을 볼 수 있습니다. 그 아래에는 블록 #0을 포함하여 서로 연결된 277,316개의 블록이 블록 #0, 즉 제네시스 블록까지의 블록체인으로 연결되어 있습니다. 시간이 지남에 따라 블록의 '높이'가 증가함에 따라 각 블록과 전체 체인에 대한 계산 난이도도 증가합니다.

앨리스의 거래가 포함된 블록 이후에 채굴된 블록은 더 긴 체인에 더 많은 계산이 쌓이면서 추가적인 보증 역할을 합니다. 관례상 6회 이상의 확인을 받은 블록은 아무리 계산해도 무효화할 수 없다고 간주되며, 이는 6개의 블록을 무효화하고 재계산하기에는 막대한 양의 계산이 필요하기 때문입니다. 우리는 10장에서 채굴 과정과 그것이 신뢰를 구축하는 방식을 더 자세히 살펴볼 것입니다.

### 거래 소비하기

 이제 앨리스의 거래가 블록의 일부로 블록체인에 삽입되었으므로, 이는 비트코인의 분산 원장에 포함되어 모든 비트코인 애플리케이션에서 볼 수 있습니다. 각 비트코인 클라이언트는 거래가 유효하고 사용할 수 있는지 독립적으로 확인할 수 있습니다. 풀노드 클라이언트는 비트코인이 블록에서 처음 생성된 순간부터 자금 출처를 추적할 수 있으며, 거래에서 거래로 점진적으로 추적하여 밥의 주소에 도달할 때까지 진행됩니다. 경량 클라이언트는 이 거래가 블록체인에 있고 그 뒤에 여러 개의 블록이 채굴되었음을 확인하여 '단순화된 지불 확인(SPV) 노드'라고 하는 것을 수행할 수 있습니다(183페이지 참조). 따라서 채굴자들이 이 거래를 유효한 것으로 인정했다고 보장해줍니다. 이제 밥은 이 거래 및 다른 거래의 출력을 사용할 수 있습니다. 예를 들어, 밥은 앨리스의 커피 컵 결제에서 이러한 새로운 소유자에게 가치를 이전하여 계약자나 공급업체에게 지불할 수 있습니다. 아마도 밥의 비트코인 소프트웨어는 여러 작은 지불을 더 큰 지불로 집계할 것이며, 아마도 하루 동안의 모든 비트코인 수익을 단일 거래로 집중시킬 것입니다.

이것은 다양한 지불을 단일 출력(및 단일 주소)으로 집계합니다. 집계 거래의 다이어그램은 그림 2-6을 참조하세요. Bob이 Alice와 다른 고객으로부터 받은 지불을 사용함에 따라 그는 거래의 체인을 확장합니다. 이제 Bob이 그의 웹 디자이너 Gopesh에게 새로운 웹사이트 페이지를 위해 Banga lore로 지불한다고 가정해 보겠습니다. 이제 거래의 체인은 그림 2-10처럼 보일 것입니다.

이번 장에서는 거래가 소유자에서 소유자로 가는 가치를 이동시키는 체인을 어떻게 구축하는지 살펴보았습니다. 또한 우리는 앨리스의 거래가 그녀의 지갑에서 생성된 순간부터 비트코인 네트워크를 거쳐 그것을 블록체인에 기록한 채굴자들에게 도달하기까지의 과정을 추적했습니다. 이 책의 나머지 부분에서는 지갑, 주소, 서명, 거래, 네트워크, 그리고 마지막으로 채굴 뒤에 있는 특정 기술들을 살펴볼 것입니다.




