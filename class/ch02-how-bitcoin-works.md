# 교재 예습

### 거래, 블록, 채굴 및 블록체인

비트코인 시스템은 전통적인 은행 및 결제 시스템과 달리 분산된 신뢰를 기반으로 합니다. 중앙 집중식 신뢰 권한 대신, 비트코인에서는 신뢰가 비트코인 시스템 내의 다양한 참가자 간의 상호작용에서 나타나는 emergent property로 형성됩니다. 이 장에서는 비트코인의 단일 거래를 추적하여 고차원적으로 비트코인을 살펴보고, 그것이 ‘신뢰받는’ 상태가 되고 비트코인 분산 합의 메커니즘에 의해 수용되며, 마지막으로 모든 거래의 분산 원장인 블록체인에 기록되는 과정을 살펴보겠습니다. 이후 장에서는 거래, 네트워크 및 채굴 뒤에 있는 기술에 대해 심도 있게 다룰 것입니다.

### 비트코인 개요

그림 2-1에 표시된 개요 다이어그램에서 비트코인 시스템은 키가 포함된 지갑을 가진 사용자, 네트워크를 통해 전파되는 거래, 경쟁적인 계산을 통해 합의된 블록체인을 생산하는 채굴자로 구성되어 있음을 확인할 수 있습니다. 이 장의 각 예시는 비트코인 네트워크에서 실제로 이루어진 거래를 기반으로 하며, 사용자(조, 앨리스, 밥, 고페시)가 하나의 지갑에서 다른 지갑으로 자금을 보내는 과정을 시뮬레이션하여 상호작용을 설명합니다. 비트코인 네트워크를 통해 블록체인까지 거래를 추적하는 동안 블록체인 탐색기 사이트를 사용하여 각 단계를 시각화할 것입니다. 블록체인 탐색기는 비트코인 검색 엔진으로 작동하는 웹 애플리케이션으로, 주소, 거래 및 블록을 검색하고 그들 간의 관계와 흐름을 볼 수 있게 해줍니다.

그림 2-1. 비트코인 개요

인기 있는 블록체인 탐색기는 다음과 같습니다: • 비트코인 블록 탐색기 • 블록사이퍼 탐색기 • [blockchain.info](http://blockchain.info/) • BitPay 인사이트

이들 각각은 비트코인 주소, 거래 해시, 블록 번호 또는 블록 해시를 입력하여 비트코인 네트워크에서 해당 정보를 검색할 수 있는 검색 기능을 제공합니다. 각 거래 또는 블록 예시와 함께, 사용자가 직접 찾아보고 자세히 연구할 수 있도록 URL을 제공할 것입니다. 커피 한 잔 사기 이전 장에서 소개된 앨리스는 첫 비트코인을 방금 획득한 새로운 사용자입니다. 10페이지의 “첫 번째 비트코인 얻기”에서 앨리스는 친구 조와 만나 현금을 비트코인으로 교환했습니다. 조가 생성한 거래는 앨리스의 지갑에 0.10 BTC를 채워주었습니다. 이제 앨리스는 캘리포니아 팔로알토에 있는 밥의 커피숍에서 커피 한 잔을 사는 최초의 소매 거래를 하게 됩니다. 밥의 카페는 최근 결제 시스템에 비트코인 옵션을 추가하여 비트코인 결제를 받기 시작했습니다. 밥의 카페 가격은 지역 통화(미국 달러)로 표시되어 있지만, 계산대에서는 고객이 달러 또는 비트코인으로 결제할 수 있는 옵션이 있습니다.

앨리스는 커피 한 잔을 주문하고, 밥은 모든 거래와 마찬가지로 이를 등록기에 입력합니다. 판매 시점 시스템은 자동으로 총 가격을 현재 시장 환율로 미국 달러에서 비트코인으로 변환하여 두 통화 모두에서 가격을 표시합니다: 총: $1.50 USD 0.015 BTC. 밥은 "그건 1.50달러 또는 15밀리비트입니다."라고 말합니다. 밥의 판매 시점 시스템은 또한 결제 요청을 포함하는 특별한 QR 코드를 자동으로 생성합니다(그림 2-2를 참조). 단순히 목적지 비트코인 주소를 포함하는 QR 코드와 달리, 결제 요청은 목적지 주소, 결제 금액 및 "밥의 카페"와 같은 일반적인 설명을 포함하는 QR 인코딩된 URL입니다. 이를 통해 비트코인 지갑 애플리케이션은 결제를 보내는 데 사용되는 정보를 미리 입력할 수 있으며, 사용자에게는 읽기 쉬운 설명을 표시합니다. 비트코인 지갑 애플리케이션으로 QR 코드를 스캔하면 앨리스가 볼 수 있는 내용을 확인할 수 있습니다.

지갑으로 이걸 스캔하여 주소와 금액을 확인해 보세요. 그러나 돈을 보내지 마세요.

앨리스는 스마트폰을 사용하여 화면에 표시된 바코드를 스캔합니다. 그녀의 스마트폰은 밥의 카페에 0.0150 BTC의 결제 금액을 보여주고, 그녀는 결제를 승인하기 위해 전송을 선택합니다. 몇 초 내에 (신용카드 승인과 비슷한 시간 동일), 밥은 등록기에서 거래를 확인하고, 거래가 완료됩니다. 다음 섹션에서는 이 거래를 좀 더 자세히 살펴보겠습니다. 우리는 앨리스의 지갑이 이것을 어떻게 구성했는지, 네트워크를 통해 어떻게 전파되었는지, 어떻게 검증되었는지, 그리고 마지막으로 밥이 이후 거래에서 그 금액을 어떻게 사용할 수 있는지를 보게 될 것입니다. 비트코인 네트워크는 밀리비트코인(비트코인의 1/1000)부터 비트코인의 1/100,000,000까지의 분수 값으로 거래할 수 있습니다. 이는 사토시로 알려져 있습니다. 이 책에서는 가장 작은 단위(1 사토시)에서 모든 비트코인이 채굴될 총 수량(21,000,000)까지 모든 비트코인 화폐의 양을 지칭하기 위해 '비트코인'이라는 용어를 사용할 것입니다.

### 비트코인 거래

간단히 말하면, 거래는 네트워크에 특정 비트코인 가치를 소유하고 있는 사람이 그 가치를 다른 소유자에게 이전하도록 승인했다는 것을 알리는 것입니다. 새로운 소유자는 다른 소유자에게 이전을 승인하는 또 다른 거래를 생성함으로써 비트코인을 사용할 수 있으며, 이러한 방식으로 소유권의 연쇄가 이어집니다. 거래 입력과 출력 거래는 복식부기 장부의 항목처럼 보입니다. 각 거래는 비트코인 계정에 대한 차변과 같은 하나 이상의 '입력'을 포함합니다. 거래의 반대편에는 비트코인 계정에 추가되는 신용과 같은 하나 이상의 '출력'이 있습니다. 입력과 출력(차변 및 신용)의 합계가 반드시 동일하지는 않습니다. 대신 출력의 총합은 입력보다 약간 적으며, 그 차이는 담장자(마이너)가 거래를 장부에 포함시키기 위해 징수하는 소액의 거래 수수료를 나타냅니다. 비트코인 거래는 도표 2-3의 장부 항목으로 표시됩니다.

이 거래는 또한 지출되는 비트코인의 각 금액(입력)에 대한 소유권 증명을 포함하고 있으며, 이는 소유자의 디지털 서명의 형태로 제공되며, 이는 누구나 독립적으로 검증할 수 있습니다. 비트코인 용어로 '지출'은 이전 거래에서 새로운 소유자에게 비트코인 주소로 식별된 가치를 이전하는 거래에 서명하는 것입니다.

### 거래 체인

애리슨의 지불이 밥의 카페에 사용된 것은 이전 거래의 출력을 입력으로 사용하는 것입니다. 이전 장에서 애리슨은 현금과 맞바꿔 친구 조에게서 비트코인을 받았습니다. 그 거래는 애리슨의 키에 의해 잠긴 비트코인 가치를 생성했습니다. 애리슨의 새로운 거래는 밥의 카페에 대해 이전 거래를 입력으로 참조하고 커피 한 잔을 위한 새 출력을 생성하며 잔돈을 받습니다. 거래는 체인을 형성하여 최신 거래의 입력이 이전 거래의 출력에 해당합니다. 애리슨의 키는 이전 거래 출력을 해제하는 서명을 제공하여 비트코인 네트워크에 그녀가 자금을 소유하고 있음을 증명합니다. 그녀는 커피에 대한 지불을 밥의 주소에 첨부하여 해당 출출을 '포획'하여 밥이 그 금액을 사용하기 위해 서명을 생성해야 한다는 요구 조건을 추가합니다. 이는 애리슨과 밥 간의 가치 이전을 나타냅니다. 조에서 애리슨, 애리슨에서 밥으로 이어지는 이 거래 체인은 도표 2-4에 나와 있습니다.

### 변경 사항 만들기

많은 비트코인 거래에는 새로운 소유자의 주소와 현재 소유자의 주소를 참조하는 출력이 포함됩니다. 이를 변경 주소라고 합니다. 이는 거래 입력이 통화 지폐처럼 분할될 수 없기 때문입니다. 가게에서 5달러의 상품을 구매하지만 20달러 지폐로 지불할 경우, 15달러의 잔돈을 받을 것으로 예상합니다. 같은 개념이 비트코인 거래 입력에도 적용됩니다. 5비트코인짜리 상품을 구매했지만 20비트코인 입력만 사용할 수 있다면, 5비트코인을 가게 소유자에게 보내고 15비트코인을 잔돈으로 본인에게 다시 보냅니다(적용 가능한 거래 수수료를 제외하고). 중요한 점은 변경 주소가 입력 주소와 동일할 필요는 없으며, 개인 정보 보호 이유로 종종 소유자의 지갑에서 새로운 주소가 사용됩니다. 다른 지갑은 사용자 요청에 따라 지불을 하기 위해 입력을 집계할 때 서로 다른 전략을 사용할 수 있습니다. 여러 작은 입력을 집계하거나 원하는 지불액과 같거나 큰 입력을 사용할 수 있습니다. 지갑이 원하는 지불액과 거래 수수료를 정확히 일치시키도록 입력을 집계할 수 없는 경우, 지갑은 일부 잔돈을 생성해야 합니다. 이는 사람들이 현금을 다루는 방식과 매우 유사합니다. 만약 항상 주머니에 있는 가장 큰 지폐를 사용한다면, 잔돈으로 가득 찬 주머니가 될 것입니다. 잔돈만 사용하면 항상 큰 지폐만 있게 됩니다. 사람들은 본능적으로 이 두 극단 사이에서 균형을 찾고, 비트코인 지갑 개발자들은 이 균형을 프로그래밍하려고 노력하고 있습니다.

요약하자면, 거래는 거래 입력에서 거래 출력으로 가치를 이동합니다. 입력은 이전 거래의 출력에 대한 참조로, 가치가 어디에서 오는지를 보여줍니다. 거래 출력은 특정 가치를 새로운 소유자의 비트코인 주소로 지정하며 원래 소유자에게 반환되는 잔돈을 포함할 수 있습니다. 한 거래의 출력은 새로운 거래의 입력으로 사용될 수 있어, 소유자가 가치를 이동시키면서 소유권의 연쇄를 생성합니다(그림 2-4 참조). 일반적인 거래 형태 가장 일반적인 거래 형태는 한 주소에서 다른 주소로의 단순 지불로, 종종 원래 소유자에게 반환되는 일부 '잔돈'이 포함됩니다. 이 유형의 거래는 하나의 입력과 두 개의 출력을 가지며 그림 2-5에 표시됩니다.

또 다른 일반적인 거래 형태는 여러 개의 입력을 하나의 출력으로 집계하는 것입니다(그림 2-6 참조). 이는 동전과 지폐 더미를 하나의 큰 지폐로 교환하는 현실 세계의 동등한 형태를 나타냅니다. 이러한 거래는 때때로 지불의 잔돈으로 받은 소액을 정리하기 위해 지갑 애플리케이션에서 생성되기도 합니다.

마지막으로, 비트코인 원장에서 자주 볼 수 있는 또 다른 거래 형태는 하나의 입력을 여러 출력으로 분배하는 거래입니다. 이는 여러 수신자를 나타냅니다(그림 2-7 참조). 이러한 유형의 거래는 상업적 기관이 여러 직원에게 급여를 처리할 때와 같이 자금을 분배하는 데 사용되기도 합니다.

### 거래 구성

알리스의 지갑 애플리케이션은 알리스의 사양에 맞는 거래를 구성하기 위한 적절한 입력 및 출력을 선택하는 모든 로직을 포함하고 있습니다. 알리스는 목적지와 금액만 지정하면 나머지는 지갑 애플리케이션에서 세부사항을 보지 않고 진행됩니다. 중요한 점은, 지갑 애플리케이션은 완전히 오프라인 상태에서도 거래를 구성할 수 있다는 것입니다. 집에서 수표를 작성한 후 나중에 봉투에 넣어 은행에 보내는 것처럼, 거래는 비트코인 네트워크에 연결된 상태에서 구성되고 서명될 필요가 없습니다.

### 올바른 입력 얻기

알리스의 지갑 애플리케이션은 먼저 보브에게 보내고자 하는 금액을 지불할 수 있는 입력을 찾아야 합니다. 대부분의 지갑은 지갑에 있는 주소에 속한 모든 사용 가능한 출력을 추적합니다. 따라서 알리스의 지갑에는 현금으로 교환된 조의 거래에서 생성된 거래 출력의 사본이 포함되어 있을 것입니다(10페이지의 '비트코인 첫 구매하기' 참조). 전체 노드 클라이언트로 실행되는 비트코인 지갑 애플리케이션은 블록체인에서 모든 사용되지 않은 출력의 사본을 실제로 포함하고 있습니다. 이는 지갑이 거래 입력을 구성할 수 있게 해주고 수신 거래가 올바른 입력을 가지고 있는지 빠르게 검증할 수 있게 해 줍니다. 그러나 전체 노드 클라이언트는 많은 디스크 공간을 차지하므로 대부분의 사용자 지갑은 사용자의 사용되지 않은 출력만 추적하는 '경량' 클라이언트를 실행합니다.
