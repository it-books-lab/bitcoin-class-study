# Ch06. Transaction

Q. 강의자료에 '거래 ▪ 앨리스 주소에서 밥 주소로 이루어지는 거래 – 거래에 포함된 내용을 단순화하여 본 것'라는 내용이 있거든? 근데, 나는 '프라이빗키는 비트코인을 사용하기 위한 것, 퍼블릭키는 서명에 대한 유효성을 확인하기 위한 것, 주소는 비트코인을 받기 위해 상대에게 보여주기 위한 것'이라고 알고 있단 말이야. 그런데, 왜 '앨리스 주소에서 밥 주소로 이루어지는 거래'라는거야? 비트코인을 받을 밥만 주소가 필요한 거 아니야? 비트코인을 주는 앨리스는 왜 주소가 필요한거야?

### 1️⃣ 기본 개념 복습

- **프라이빗 키(private key)**: 내 돈을 쓰기 위한 열쇠. 절대 다른 사람에게 알려주면 안 됨.
- **퍼블릭 키(public key)**: 내 프라이빗 키와 짝을 이루는 공개키. 서명을 검증할 때 사용됨.
- **주소(address)**: 비트코인을 보내거나 받을 때 상대방에게 알려주는 식별자. 퍼블릭 키를 해싱해서 만든 것.

정리하면:

- **받을 때**: 상대에게 내 주소를 알려주면 됨.
- **보낼 때**: 내 프라이빗 키로 거래에 서명해야 함.

---

### 2️⃣ 거래(transaction)가 ‘앨리스 주소 → 밥 주소’로 표현되는 이유

교재나 강의에서 "앨리스 주소에서 밥 주소로 이루어지는 거래"라고 말하는 건, **거래의 흐름을 단순하게 시각화한 표현**이에요. 실제로는 이런 과정이 일어납니다:

1. **앨리스가 비트코인을 보냄**
    - 앨리스는 **자신의 UTXO(사용 가능한 비트코인 잔액)**를 사용합니다.
    - 거래에 서명할 때 **앨리스의 프라이빗 키**로 서명합니다.
2. **거래 정보에 기록**
    - 거래에는 ‘입력(Input)’과 ‘출력(Output)’이 있어요.
        - 입력: 앨리스가 소유한 코인 정보
        - 출력: 밥의 주소와 전송 금액
3. **밥이 받음**
    - 밥은 자신의 **주소를 출력(Output)**으로 등록해둡니다.
    - 이제 블록체인에 밥의 주소로 코인이 기록됨.

즉, 거래에서 앨리스의 **주소가 필요한 이유**는 단순히 “보낸 사람 누구인지, 어떤 코인을 사용했는지”를 기록하고, 블록체인상에서 **UTXO를 추적**하기 위해서예요.

- 앨리스의 주소 = 어떤 UTXO가 사용됐는지 나타내는 표시
- 밥의 주소 = 누구에게 보내는지 나타내는 표시

그래서 **교과서처럼 ‘앨리스 주소 → 밥 주소’**라고 쓰는 거예요. 실제로 앨리스는 자신의 주소를 모를 필요는 없지만, 거래 기록에는 넣어야 블록체인이 금액 흐름을 추적할 수 있어요.

---

### 3️⃣ 핵심 포인트

- 주소는 받는 사람만 필요한 게 아니라, **보낸 사람도 거래 기록을 위해 필요함**
- 프라이빗 키는 **서명**에 쓰임 → 앨리스만 서명 가능
- 퍼블릭 키/주소는 **검증**과 **식별**에 쓰임 → 누구에게서 누구에게 갔는지 기록

---



<img width="1526" height="857" alt="image" src="https://github.com/user-attachments/assets/07a6b6ec-1e23-4b28-9049-14c9a5e35408" />


좋아요. 이 이미지는 **비트코인 거래(Transaction)**의 세부 정보를 보여주는 블록 탐색기 화면 예시입니다. 각각의 항목을 하나씩 풀어서 설명드릴게요.

---

## 🧾 전체 구조 요약

비트코인은 “**입력(Input)** → **출력(Output)**”의 형태로 거래를 기록합니다.
즉, **이전 거래의 결과(출력)**를 **다음 거래의 입력**으로 사용하는 구조예요.

이 화면은 하나의 거래(transaction)가

* **어디서 왔는지(Inputs)**,
* **어디로 갔는지(Outputs)**,
* **얼마나의 수수료가 있었는지**
  등을 시각화한 것입니다.

---

## 📦 상단 영역

### **Transaction ID (TxID)**

```
0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2
```

* 이 거래를 고유하게 식별하는 해시값입니다.
* 거래가 블록체인에 기록되면 이 해시로 검색할 수 있습니다.

---

## 🟦 왼쪽 (Input, “보내는 쪽”)

```
1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK (0.1 BTC - Output)
```

* **이전 거래의 출력(Output)**을 **이번 거래의 입력(Input)**으로 사용한 주소입니다.
* 즉, “이 주소의 비트코인을 사용해서 새 거래를 만든 것”입니다.
* 이 주소는 “보내는 사람(앨리스)”의 주소에 해당합니다.
* `(0.1 BTC - Output)`은 이 주소에서 이전에 받은 코인이 0.1 BTC였다는 뜻입니다.

> **즉:** 앨리스가 과거에 0.1 BTC를 받았고, 지금 이걸 사용해서 보낸 거래라는 뜻이에요.

---

## 🟩 오른쪽 (Output, “받는 쪽”)

```
1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA   0.015 BTC (Unspent)
1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK   0.0845 BTC (Unspent)
```

* 이번 거래의 결과로 **두 개의 출력(Output)**이 생성되었습니다.

| 주소                                   | 설명                      | 금액         |
| ------------------------------------ | ----------------------- | ---------- |
| `1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA` | **받는 사람(밥)**의 주소        | 0.015 BTC  |
| `1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK` | **보내는 사람(앨리스)의 잔돈 주소)** | 0.0845 BTC |

* 두 Output 모두 `(Unspent)` 상태인데, 이는 아직 사용되지 않았다는 뜻입니다.
* 밥은 0.015 BTC를 새로 받았고, 앨리스는 남은 0.0845 BTC를 자신에게 다시 돌려받았습니다.

---

## 📊 Summary (요약 정보)

| 항목                    | 설명                               |
| --------------------- | -------------------------------- |
| **Size**              | 거래 데이터 크기 (258 bytes)            |
| **Received Time**     | 거래가 전파된 시각 (2013-12-27 23:03:05) |
| **Included in Block** | 이 거래가 포함된 블록 번호 277316           |
| **Confirmations**     | 현재 블록 이후 97개의 블록이 쌓여 확정됨 (안전성↑)  |

---

## 💰 Inputs and Outputs (입출금 요약)

| 항목                           | 값          | 설명                   |
| ---------------------------- | ---------- | -------------------- |
| **Total Input**              | 0.1 BTC    | 앨리스가 사용한 코인 총액       |
| **Total Output**             | 0.0995 BTC | 수신자 + 잔돈 총액          |
| **Fees**                     | 0.0005 BTC | 수수료 (채굴자에게 지급)       |
| **Estimated BTC Transacted** | 0.015 BTC  | 실제 송금된 금액 (밥이 받은 금액) |

---

## 🧠 요약 정리

이 거래를 인간 언어로 번역하면 다음과 같습니다 👇

> **앨리스(1Cdid9...)가 밥(1GdK9...)에게 0.015 BTC를 보냈다.**
> 총 0.1 BTC를 사용했고,
> 0.0845 BTC는 거스름돈으로 자기 자신에게 돌려받았다.
> 0.0005 BTC는 거래 수수료로 소모되었다.

---


Q. 방금 그 사진 속에서 프라이빗키와 퍼블릭키가 어디에 쓰인거야? output에 있는 주소를 만들 때, 앨리스의 프라이빗키와 퍼블릭키가 사용된 건가?
'ncluded in Block: 이 거래가 포함된 블록 번호 277316'이고, 'Confirmations: 현재 블록 이후 97개의 블록이 쌓여 확정됨'이라면 블록 하나에는 여러 개의 transaction들이 있는 거고, 여러 개의 transaction들을 가진 블록들 97가 해당 블록 뒤로 97개나 체인되었다는 말인가?

## ✅ 1️⃣ 프라이빗키·퍼블릭키는 어디서 쓰였는가?

좋은 질문이에요 —

**“Output에 있는 주소를 만들 때 프라이빗키와 퍼블릭키가 사용된 거야?”** 라는 건 아주 근본적인 궁금증이에요.

정답은 **“퍼블릭키로 주소를 만든다”**이고,

**“프라이빗키는 거래를 ‘보낼 때’ 사용된다”** 입니다.

---

### 🔹 (1) Output에 표시된 주소가 만들어지는 과정

예를 들어, 사진 속의

```
1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA

```

이런 문자열이 **비트코인 주소**입니다.

이건 아래 과정을 거쳐 만들어집니다 👇

1. **퍼블릭키 생성**:
    
    프라이빗키(개인키)를 이용해 ECDSA(Elliptic Curve Digital Signature Algorithm)로 퍼블릭키를 생성.
    
    ```
    private key  →  public key
    
    ```
    
2. **퍼블릭키 해시화**:
    
    퍼블릭키를 SHA-256 → RIPEMD-160으로 해시해 짧게 만듦.
    
    (`Hash160(public key)`)
    
3. **주소 형식으로 인코딩(Base58Check)**
    
    네트워크 정보(예: 메인넷 0x00) + 해시 + 체크섬을 붙여
    
    `1GdK9Uzp...` 같은 주소 문자열이 만들어짐.
    

> 즉, Output에 있는 주소는 받는 사람의 퍼블릭키 해시를 사람이 보기 좋게 바꾼 문자열이에요.
> 

---

### 🔹 (2) 그럼 프라이빗키는 언제 쓰이냐?

- *보내는 사람(앨리스)**이 **새로운 거래를 만들 때**,

이전 Output을 Input으로 사용하면서 **“내가 이 코인을 쓸 권리가 있다”**는 것을 증명해야 해요.

그 증명 수단이 바로 **디지털 서명**이고,

이때 앨리스의 **프라이빗키로 거래에 서명**합니다.

- 거래 생성: “이전 Output(0.1BTC)을 써서 새로운 Output 두 개를 만들겠다.”
- 서명: 앨리스의 프라이빗키로 거래 전체에 전자서명.
- 검증: 네트워크의 다른 노드들은 **앨리스의 퍼블릭키**로 이 서명이 유효한지 확인.

즉 👇

| 역할 | 사용되는 키 | 설명 |
| --- | --- | --- |
| 주소 생성 | **퍼블릭키 (공개키)** | 주소는 퍼블릭키로부터 파생 |
| 거래 서명 | **프라이빗키 (개인키)** | 거래를 보낼 때 “내 돈임”을 증명 |

---

## ✅ 2️⃣ Confirmations의 의미 (블록 체인 구조)

> “Included in Block: 277316”
> 
> 
> “Confirmations: 97”
> 

이 두 줄을 정확히 이해하셨어요 👏

---

### 🔹 (1) 블록 하나에는 여러 개의 거래가 들어감

맞아요.

비트코인의 **하나의 블록(block)** 안에는 **수백~수천 개의 거래(transaction)**가 포함됩니다.

그래서

```
277316번 블록
└── Transaction 1
└── Transaction 2
└── Transaction 3
   ...

```

이런 식으로 기록되어 있죠.

---

### 🔹 (2) Confirmations = 이후에 붙은 블록 수

“Confirmations: 97”은

`277316번 블록`이 블록체인에 포함된 후,

그 뒤로 **97개의 블록이 더 이어졌다**는 뜻입니다.

즉, 현재 블록체인의 맨 끝은

```
277316 + 97 = 277413번째 블록

```

쯤이 되겠죠.

---

### 🔹 (3) 왜 확인(confirmation)이 중요할까?

비트코인 네트워크는 분산되어 있기 때문에,

새 블록이 생성될 때 **임시로 체인 분기가 생길 수** 있습니다.

그래서 비트코인은 보통 이렇게 간주해요 👇

| 확인 횟수 | 신뢰 수준 | 의미 |
| --- | --- | --- |
| 0 | 매우 위험 | 막 전송된 상태 (아직 블록에 포함 안됨) |
| 1~2 | 낮음 | 블록에 포함됐지만 확정은 아님 |
| 6 이상 | 매우 안전 | 거래가 되돌릴 수 없을 정도로 확정됨 |

사진에선 97회니까,

거래가 완전히 확정된 상태입니다 ✅

---

## 🧩 정리 요약

| 개념 | 설명 | 사진 속 예시 |
| --- | --- | --- |
| **퍼블릭키** | 주소 생성에 사용됨 | Output 주소 (`1GdK9...`)는 퍼블릭키 해시 기반 |
| **프라이빗키** | 거래 서명(보낼 때 증명)에 사용됨 | 앨리스가 Input을 사용할 때 서명 |
| **블록** | 여러 거래의 묶음 | 블록 277316에 포함됨 |
| **Confirmations 97** | 97개의 블록이 뒤에 추가됨 → 거래 확정 | 매우 안전한 상태 |

---

Q. 그러면,
input에 있는 주소(1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK (0.1 BTC - Output) )는 앨리스의 프라이빗키를 통해 사용을 증명할 수 있는거고,
사진 위쪽에 있던 0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2는 앨리스의 프라이빗키로 서명된 결과물이야?
output에 있던 1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA   0.015 BTC (Unspent), 1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK   0.0845 BTC (Unspent) 라는 두 주소는 각각 앨리스와 밥의 퍼블릭키를 통해 만들어진거야?

## 🧩 1️⃣ Input에 있는 주소는 앨리스의 프라이빗키로 사용을 증명한다 — ✅ **맞습니다**

```
1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK (0.1 BTC - Output)

```

이건 **이전 거래의 Output**, 즉 **앨리스가 과거에 받았던 비트코인**이에요.

앨리스가 이걸 지금 **Input으로 사용한다**는 건,

“이 0.1 BTC는 내 거니까 내가 쓸게”를 증명하는 행위죠.

그 증명 수단이 바로 **앨리스의 프라이빗키로 한 전자서명(digital signature)** 입니다.

즉,

> 앨리스의 프라이빗키로 ‘이 Input을 내가 쓰는 거래다’라는 메시지를 서명함
> 
> 
> → 네트워크의 모든 노드가 앨리스의 퍼블릭키로 서명 유효성 검증
> 
> → 유효하면 “아, 이건 진짜 앨리스가 쓴 거래네” 하고 인정
> 

요약하자면

- Input 주소는 퍼블릭키 해시 형태로 저장되어 있고,
- **그 주소의 주인이 실제로 코인을 쓸 때 프라이빗키로 서명**해야 합니다 ✅

---

## 🧾 2️⃣ “0627052b6f28912f...” 은 앨리스의 프라이빗키로 서명된 결과물인가? — ❌ **직접적으로는 아닙니다**

이 부분이 헷갈리기 쉬워요.

이 긴 문자열은 **거래 전체(Transaction)의 식별자**, 즉 **트랜잭션 해시(Transaction ID, TxID)**입니다.

```
0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2

```

이건 **앨리스의 프라이빗키로 만든 서명 결과물이 아니라**,

**“거래 데이터 전체를 해시한 값”**이에요.

즉 👇

| 항목 | 설명 |
| --- | --- |
| **디지털 서명(Signature)** | 앨리스의 프라이빗키로 생성됨. 거래의 일부에 포함됨. |
| **트랜잭션 ID(TxID)** | 거래 전체(입력·출력·서명 포함)를 해시(SHA-256x2)한 결과. |

서명은 거래 안쪽에 포함되어 있고,

TxID는 거래 전체의 “요약 해시”입니다.

따라서

> “TxID는 앨리스의 프라이빗키로 서명된 결과물”이 아니라,
> 
> 
> “프라이빗키 서명이 포함된 거래 전체를 SHA-256으로 두 번 해싱한 식별자”입니다.
> 

---

## 🎯 3️⃣ Output의 두 주소는 앨리스와 밥의 퍼블릭키 기반으로 만들어진 거야? — ✅ **정확합니다**

사진의 Output 두 개를 보면 👇

| 주소 | 금액 | 주인 | 설명 |
| --- | --- | --- | --- |
| `1GdK9UzpHBzqzX2A9JFP3Di4weBwqgmoQA` | 0.015 BTC | **밥(Bob)** | 밥이 새로 받는 코인 (송금 대상) |
| `1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK` | 0.0845 BTC | **앨리스(Alice)** | 앨리스가 돌려받는 잔돈 (change) |

이 두 주소 모두 **각자의 퍼블릭키를 해시해서 만든 주소**예요.

즉:

- 밥은 `publicKey_Bob → hash160 → address_Bob`
- 앨리스는 `publicKey_Alice → hash160 → address_Alice`

그 결과로 저 두 Output 주소가 생깁니다.

그리고 거래가 블록체인에 기록될 때

Output에는 **퍼블릭키 해시(public key hash)**가 저장돼요.

다음에 이 Output을 누군가 쓰려면

그 퍼블릭키와 그에 대한 유효한 서명을 함께 제시해야 합니다.

---

## 💡 요약 정리

| 구분 | 대상 | 관련 키 | 설명 |
| --- | --- | --- | --- |
| **Input** | `1Cdid9KFAaatwczBwBttQcwxYCpvK8h7FK` | **프라이빗키(서명 시 사용)** | 앨리스가 과거 Output을 사용하는 것. “내 돈임”을 프라이빗키 서명으로 증명 |
| **TxID** | `0627052b6f...` | ❌ (서명 아님) | 거래 전체 데이터를 해시한 식별자 (SHA-256x2) |
| **Output** | `1GdK9UzpHB...`, `1Cdid9KFA...` | **퍼블릭키 기반 주소** | 밥과 앨리스의 퍼블릭키로부터 만들어진 새 주소들 |
| **서명(Signature)** | 거래 내부 필드 중 하나 | **앨리스의 프라이빗키** | TxID 생성엔 포함되지만, 그 자체가 TxID는 아님 |

---

